

<!DOCTYPE html>
<html class="writer-html5" lang="en,pt-BR" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Comunicação Serial &mdash; CoopRobo 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Comunicação Via Modem" href="../4-modem/4.0-intro.html" />
    <link rel="prev" title="Registradores" href="3.3-register.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> CoopRobo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Robots</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../aerial.html">Aerial Robots</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../vr01.html">VR-01</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../1-autopilot/1.0-pilot.html">Piloto Automatico</a></li>
<li class="toctree-l3"><a class="reference internal" href="../1-autopilot/1.1-config_pilot.html">Configuração do Piloto Automatico</a></li>
<li class="toctree-l3"><a class="reference internal" href="../2-embedded_system/2.0-embedded_system.html">Sistema Embarcado</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="3.0-intro.html">Utilizando o computador embarcado</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="3.1-Ambient_Linux.html">Ambientando-se ao Linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="3.2-CrossCompilation.html">Compilação Cruzada</a></li>
<li class="toctree-l4"><a class="reference internal" href="3.3-register.html">Registradores</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Comunicação Serial</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../4-modem/4.0-intro.html">Comunicação Via Modem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../5-hardware/5.0-intro.html">Desenvolvimento do Hardware Central</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vr01.html#referencias">Referências</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../mobile.html">Mobile Robots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../manipulators.html">Manipulators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs-ref.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../camera.html">Camera</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">CoopRobo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../aerial.html">Aerial Robots</a> &raquo;</li>
        
          <li><a href="../../vr01.html">VR-01</a> &raquo;</li>
        
          <li><a href="3.0-intro.html">Utilizando o computador embarcado</a> &raquo;</li>
        
      <li>Comunicação Serial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/aerial/vr01/3-gumstix/3.4-Serial.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="comunicacao-serial">
<h1>Comunicação Serial<a class="headerlink" href="#comunicacao-serial" title="Permalink to this headline">¶</a></h1>
<p>A principal característica da comunicação serial é o processo de enviar dados um bit de cada vez, de forma sequencial, através de um canal de comunicação ou barramento. Diferente da comunicação paralela, em que todos os bits de cada símbolo são enviados juntos.</p>
<p>Com a finalidade de possibilitar a conversão, transmissão e recepção de dados de forma serial, sendo estes originalmente dispostos de maneira paralela, surge o formato <strong>UART</strong>, acrônimo de <em>Universal Asynchrounous Receiver/Transmiter</em> ou Receptor/Transmissor Universal Assíncrono.</p>
<p>O termo &quot;Universal&quot; refere-se a característica do formato dos dados e velocidade serem configuráveis, enquanto &quot;Assíncrono&quot; diz respeito a forma de comunicação em série ocorre, em que os dispositivos não estão continuamente sincronizadas por um sinal de clock comum.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Mais detalhes sobre a comunicação UART podem ser vistos em <a class="reference external" href="https://microcontrollerslab.com/uart-communication-working-applications/">Introduction to UART Communication - microcontrollerslab.com</a>.</p>
</div>
<p>No caso do Overo, temos três sistemas de Comunicação <strong>UART</strong> implementados por hardware à nossa disposição. O que faz desnecessário qualquer implementação manual através de software utilizando GPIO.</p>
<p>Agora vamos entender como funciona o protocolo de comunicação UART. Essa comunicação funciona através da conexão do transmissor (<strong>TX</strong>) de um dispositivo com o receptor (<strong>RX</strong>) de outro dispositivo, no caso, apenas o <strong>TX</strong> realiza alterações no nível de tensão da linha, sendo assim, a comunicação é, para cada conexão, uma via de mão única. Logo, para realizar uma comunicação de mão dupla iremos utilizar duas conexões, uma será a ligação de <strong>RX</strong> do dispositivo 1 com o <strong>TX</strong> do dispositivo 2 e a outra ligação será o oposto, <strong>RX</strong> do dispositivo 2 com <strong>TX</strong> do dispositivo 1, similar a imagem abaixo.</p>
<div class="figure align-center">
<img alt="../../../_images/UART_bus.png" src="../../../_images/UART_bus.png" />
</div>
<p>Podemos analisar a situação da comunicação a nível de bit. Por exemplo, para uma comunicação UART do tipo &quot;8N1&quot; (8 bits de dados, 0 bits de paridade e 1 bit de parada) teremos o canal em estado <em>IDLE</em>, que significa &quot;não operando&quot;, representado pelo nível de tensão estático em alto. Logo, quando pretende-se iniciar a comunicação é enviado um pulso de nível baixo e em seguida são enviados os oito bits de dados que será acompanhado de um bit de parada em estado alto.</p>
<p>É importante destacar que a função do bit de parada é realizar uma pausa na transmissão para algum processamento interno dos dispositivos, não é necessário, portanto, nenhum tempo adicional entre os dados transmitidos.</p>
<p>Como essa é uma comunicação assíncrona, é essencial que a velocidade da comunicação seja pré-determinada. Essa velocidade geralmente é dada em Baud rate, uma unidade de medida para a quantidade de unidades de sinal enviadas por segundo.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>O termo &quot;Baud rate&quot; é utilizado como medida de velocidade de transmissão de dados entre dispositivos. Um baud é uma medida de velocidade de sinalização e representa o número de mudanças na linha de transmissão (seja em frequência, amplitude, fase etc...) ou eventos por segundo.</p>
</div>
<p>A figura a seguir apresenta um esquemático que ilustra o funcionamento da comunicação UART. Na ilustração a velocidade de comunicação é de 10.000.000 baud/s.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../_images/UART_8N1.png"><img alt="../../../_images/UART_8N1.png" src="../../../_images/UART_8N1.png" style="width: 500px;" /></a>
</div>
<div class="section" id="particularidades-da-gumstix-overo">
<h2>Particularidades da Gumstix Overo<a class="headerlink" href="#particularidades-da-gumstix-overo" title="Permalink to this headline">¶</a></h2>
<p>Por padrão, a placa de expansão Tobi disponibiliza apenas dois dos UARTs disponíveis no computador em modulo Overo para uso através dos seus pinos. Como pode ser visto na imagem abaixo, a UART1 está conectada aos pinos 10 e 9 e a UART3 está conectada aos pinos 22 e 21. Ainda é importante dizer que a porta serial UART3 é o mesmo pino utilizado pelo &quot;USB console&quot;, ou seja, é o mesmo pino que usamos para controlar a Gumstix pelo computador, ou seja, em configuração padrão as mensagens do sistema e as mensagens para o sistema são enviadas por esta porta.</p>
<div class="figure align-center" id="id1">
<img alt="../../../_images/Pinos_Tobi.png" src="../../../_images/Pinos_Tobi.png" />
<p class="caption"><span class="caption-text">Diagrama dos pinos da placa de expansão tobi.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>Caso as duas portas seriais já mencionadas não sejam suficientes, existe ainda a porta serial UART2. Porém, por padrão, está não está disponível em nenhum dos pinos da placa Tobi para nossa utilização. Na verdade, ela foi reservada para comunicar-se com o Bluetooth, contudo apenas versões posteriores do computador embarcado Overo por nos utilizado possuem Bluetooth, portanto podemos, caso necessário, exportar a UART2 para os pinos e utiliza-los. Para utilizar esta porta serial é necessário modificar o <em>u-boot</em> de modo a multiplexar sua função ao GPIO 146/147 que, como mostrado na figura anterior, estão ligados aos pinos 29 e 27. Portanto para fazê-lo é necessário modificar o arquivo &quot;overo.h&quot; removendo as linhas de comando referentes ao modo de GPIO dos pinos 146 e 147, remover as linhas que desabilitam a UART2 e adicionar as linhas que habilitam a comunicação serial pela UART2.</p>
<p>Para entender, detalhadamente, o que precisa ser feito e quais registradores serão alterados deve-se consultar a seção de comunicação serial do Technical Reference Manual (TRM) do processador. Contudo existe um tópico no <a class="reference external" href="http://gumstix.8.x6.nabble.com/Using-UART-2-on-an-Overo-td660403.html">Fórum de Discussões da Gumstix</a> que indica diretamente quais alterações devem ser feitos no &quot;u-boot&quot; para que se possa utilizar a UART2, apesar disso a solução apresentada nesse fórum não foi testada durante este trabalho.</p>
</div>
<div class="section" id="configuracao-da-uart">
<h2>Configuração da UART<a class="headerlink" href="#configuracao-da-uart" title="Permalink to this headline">¶</a></h2>
<p>Como já comentado anteriormente, o computador embarcado possui um hardware específico para comunicação UART, ou seja, não é necessário realizar uma implementação manual, para utilizar a comunicação UART basta escrever em alguns registradores para enviar a mensagem.</p>
<p>Na verdade, em nosso caso é ainda mais simples pois o sistema operacional instalado já traz configurado drivers para a aplicação da comunicação serial. Portanto, não é necessário acessar a memória física do dispositivo, precisamos apenas escrever no driver o que deve ser transmitido.</p>
<p>Os drivers de comunicação serial são arquivos do tipo caractere com nome &quot;<strong>ttyOx</strong>&quot;, em que &quot;<strong>x</strong>&quot; é um número exclusivo para cada uma das UARTs. Esses drivers estão localizados em &quot;<strong>/dev</strong>&quot; e funcionam como comunicação em terminal.</p>
<p>Por exemplo, o driver &quot;<strong>ttyO2</strong>&quot; é o driver de comunicação serial da porta &quot;<strong>USB Console</strong>&quot; a mesma que conectamos ao computador, ou seja, ao escrever nessa porta escreveremos no computador conectado à Gumstix e ao ler essa porta estaremos lendo o computador. Em outras palavras, escrever ou ler nesse driver terá o mesmo resultado final de chamar, respectivamente, a função <code class="docutils literal notranslate"><span class="pre">printf()</span></code> ou <code class="docutils literal notranslate"><span class="pre">scanf()</span></code>, quando um computador estiver conectado a essa porta com o terminal aberto.</p>
<p>A configuração das portas seriais pode ser feita de duas maneiras, por linhas de comando no terminal Linux ou por um código que altere as configurações do hardware. A mais simples e, novamente, mais limitada ou menos eficiente é a configuração por meio de linhas de comando, a configuração por esse modo costuma ser usada apenas quando feita por um usuário humano em tempo real.</p>
<p>Para realizar a configuração por meio do terminal Linux devemos utilizar o comando <code class="docutils literal notranslate"><span class="pre">stty</span></code>, já que esse comando possui uma enorme quantidade de parâmetros que permite estabelecer a comunicação serial da forma desejada.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Para visualizar todos os parâmetros do comando <code class="docutils literal notranslate"><span class="pre">stty</span></code> basta executar <code class="docutils literal notranslate"><span class="pre">stty</span> <span class="pre">–help</span></code> no terminal.</p>
</div>
<p>Se, por exemplo, for executada a linha de comando <code class="docutils literal notranslate"><span class="pre">stty</span> <span class="pre">-F</span> <span class="pre">/dev/ttyO0</span> <span class="pre">-a</span></code> serão impressas todas as configurações da comunicação serial <strong>UART1</strong> do dispositivo. Para imprimir apenas as principais configurações, deve-se suprimir o <code class="docutils literal notranslate"><span class="pre">-a</span></code>, a última opção do comando. Caso a alteração da velocidade seja desejável, ela pode ser alterada simplesmente acrescentando a velocidade desejada ao final da linha de comando.</p>
<p>A figura abaixo apresenta um exemplo de configuração da UART1 por meio do terminal de comandos Linux.</p>
<div class="figure align-center">
<img alt="../../../_images/config_uart1.png" src="../../../_images/config_uart1.png" />
</div>
<p>A outra maneira de configurar a comunicação serial feita por esses drivers sem alterar manualmente o conteúdo do endereço físico da memória é com o auxílio da biblioteca &quot;<strong>termios.h</strong>&quot;. Essa biblioteca possui uma ampla variedade de funções que configuram a comunicação serial com base nos parâmetros de uma estrutura &quot;<strong>termios</strong>&quot;, também definida nesta biblioteca.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Mais informações sobre a biblioteca &quot;<strong>termios.h</strong>&quot; podem ser encontrados em <a class="reference external" href="https://man7.org/linux/man-pages/man0/termios.h.0p.html">termios.h - Linux manual page</a>.</p>
</div>
<p>São dois os parâmetros da comunicação UART, além dos mencionados anteriormente, que se destacam, o número mínimo de bits que se espera ler em cada tentativa de leitura e o tempo máximo de espera por um novo caractere após a transmissão do último caractere e após o número mínimo de caracteres ser atingido.</p>
<p>O número mínimo de bits que se espera ser lido e o tempo máximo de espera pelo próximo bit em décimos de segundo podem ser configurados com os seguintes comandos <code class="docutils literal notranslate"><span class="pre">termios.c_cc[VMIN]</span> <span class="pre">=</span></code> e <code class="docutils literal notranslate"><span class="pre">termios.c_cc[VTIME]</span> <span class="pre">=</span></code>, em que <code class="docutils literal notranslate"><span class="pre">termios</span></code> é o nome de sua estrutura. Para a configuração de velocidade recomenda-se usar a função <code class="docutils literal notranslate"><span class="pre">cfsetspeed()</span></code>.Já a função <code class="docutils literal notranslate"><span class="pre">cfmakeraw()</span></code> configura, além de outros parâmetros, o funcionamento sem bit de paridade e com 8 bits de dados. Após realizados os ajustes na estrutura é necessário ainda executar a função <code class="docutils literal notranslate"><span class="pre">cfsetattr()</span></code> para que as alterações sejam feitas na UART.</p>
<p>Abaixo encontra-se o código utilizado para configurar a comunicação serial dos computadores Overo. Observe que nessa função de configuração não foi utilizada a flag &quot;O_NONBLOCK&quot; na função &quot;open()&quot; e foi definido como 1 o número mínimo de caracteres a serem retornados após uma tentativa de leitura, portanto caso o código seja executado e nenhuma informação seja enviada para este canal o processador aguardará eternamente por esse caractere. A contagem de tempo, definida como 0,1 segundo, só inicia após o número mínimo de caracteres ser atingido.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &lt;string.h&gt;</span>
<span class="c1">#include &lt;unistd.h&gt;</span>
<span class="c1">#include &lt;fcntl.h&gt;</span>
<span class="c1">#include &lt;termios.h&gt;</span>

<span class="n">void</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">struct</span> <span class="n">termios</span> <span class="n">cUART1</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">UART1</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/dev/ttyO0&quot;</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">tcgetattr</span><span class="p">(</span><span class="n">UART1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">cUART1</span><span class="p">))</span>
        <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Erro tcgetattr&quot;</span><span class="p">);</span>
    <span class="n">cfmakeraw</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cUART1</span><span class="p">);</span>
    <span class="n">cfsetspeed</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cUART1</span><span class="p">,</span><span class="n">B115200</span><span class="p">);</span>
    <span class="n">cUART1</span><span class="o">.</span><span class="n">c_cflag</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">CSTOPB</span><span class="p">;</span>

    <span class="n">cUART1</span><span class="o">.</span><span class="n">c_cc</span><span class="p">[</span><span class="n">VMIN</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">cUART1</span><span class="o">.</span><span class="n">c_cc</span><span class="p">[</span><span class="n">VTIME</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tcsetattr</span><span class="p">(</span><span class="n">UART1</span><span class="p">,</span> <span class="n">TCSANOW</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cUART1</span><span class="p">))</span>
        <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Erro tcsetattr&quot;</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>
</div>
<p><a class="reference download internal" download="" href="../../../_downloads/cc6e101fc26f2c3c635ddf31698cc5a9/config_UART.c"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">do</span> <span class="pre">código</span> <span class="pre">comentado</span></code></a></p>
<p>A figura a seguir apresenta um exemplo de configuração da UART1 por meio do codigo de configuração acima.</p>
<div class="figure align-center">
<img alt="../../../_images/config_uart1.png" src="../../../_images/config_uart1.png" />
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Com a finalidade simplificar a configuração do UART dentro de um outro código, foram efetuadas algumas modificações no código anterior para converte-lo em uma função para configuração de comunicação serial, como pode ser visto abaixo:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">configUART1</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">struct</span> <span class="n">termios</span> <span class="n">cUART1</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">UART1</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/dev/ttyO0&quot;</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">tcgetattr</span><span class="p">(</span><span class="n">UART1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">cUART1</span><span class="p">))</span>
        <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Erro tcgetattr&quot;</span><span class="p">);</span>
    <span class="n">cfmakeraw</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cUART1</span><span class="p">);</span>
    <span class="n">cfsetspeed</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cUART1</span><span class="p">,</span><span class="n">B115200</span><span class="p">);</span>
    <span class="n">cUART1</span><span class="o">.</span><span class="n">c_cflag</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">CSTOPB</span><span class="p">;</span>

    <span class="n">cUART1</span><span class="o">.</span><span class="n">c_cc</span><span class="p">[</span><span class="n">VMIN</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">cUART1</span><span class="o">.</span><span class="n">c_cc</span><span class="p">[</span><span class="n">VTIME</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tcsetattr</span><span class="p">(</span><span class="n">UART1</span><span class="p">,</span> <span class="n">TCSANOW</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cUART1</span><span class="p">))</span>
        <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Erro tcsetattr&quot;</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">UART1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Uma vez feita a configuração, foi implementado também o código a seguir com a finalidade de testar a comunicação entre dois computadores. No teste, um dispositivo envia uma mensagem para o outro dispositivo que responde com uma mensagem semelhante para o primeiro dispositivo, em seguida ambos os dispositivos imprimem a mensagem recebida.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>

    <span class="nb">int</span> <span class="n">UART1</span> <span class="o">=</span> <span class="n">configUART1</span><span class="p">();</span>  <span class="o">//</span> <span class="n">call</span> <span class="n">the</span> <span class="n">UART</span> <span class="n">configuration</span> <span class="n">function</span>
    <span class="n">char</span> <span class="n">dis</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">out</span><span class="p">[</span><span class="mi">100</span><span class="p">],</span> <span class="n">string</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>

    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Que dispositivo eu sou?&quot;</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%c</span><span class="s2">&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dis</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="n">dis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">strcat</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="s2">&quot;Ola! Essa e uma mensagem do dispositivo &quot;</span><span class="p">);</span>
    <span class="n">strcat</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">dis</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">testa</span> <span class="n">UART</span>
    <span class="n">write</span><span class="p">(</span><span class="n">UART1</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">string</span><span class="p">));</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">read</span><span class="p">(</span><span class="n">UART1</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Mensagem lida pelo dispositivo </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dis</span><span class="p">,</span> <span class="n">out</span><span class="p">);</span>
    <span class="n">close</span><span class="p">(</span><span class="n">UART1</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><a class="reference download internal" download="" href="../../../_downloads/7205c7fed245a52f9e75b37d4115d27d/comun_UART.c"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">do</span> <span class="pre">código</span> <span class="pre">completo</span></code></a></p>
<p>Como os dois dispositivos são idênticos, será necessário conectar o pino 10 de um dispositivo com o pino 9 do outro dispositivo e vice-versa. Utilizando esse código como base é possível enviar qualquer mensagem de até 100 caracteres de um dispositivo ao outro.</p>
<p>A figura a seguir apresenta o resultado do teste dos códigos apresentados. Nessa figura podemos ver dois terminais do Linux, cada um vinculado a um computador embarcado, e ambos chamam a mesma função, logo em seguida vemos a mensagem lida por cada um dos dispositivos.</p>
<div class="figure align-center">
<img alt="../../../_images/UART_com.png" src="../../../_images/UART_com.png" />
</div>
<div class="section" id="referencias">
<h3>Referências<a class="headerlink" href="#referencias" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>PITA, H. C. Desenvolvimento de sistema de comunicação multiplataforma para veículos aéreos de asa fixa. Faculdade de Tecnologia, Universidade de Brasília, 2018.</p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Universal_asynchronous_receiver-transmitter">Universal asynchronous receiver-transmitter</a> - wikipedia.org</p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Asynchronous_serial_communication">Asynchronous serial communication</a> - wikipedia.org</p></li>
<li><p><a class="reference external" href="http://newtoncbraga.com.br/index.php/telecom-artigos/1709-#:~:text=UART">Como funcionam as UARTs</a> - newtoncbraga.com.br</p></li>
<li><p><a class="reference external" href="https://ece353.engr.wisc.edu/serial-interfaces/uart-basics/">UART Basics</a> - ece353.engr.wisc.edu</p></li>
<li><p><a class="reference external" href="https://man7.org/linux/man-pages/man0/termios.h.0p.html">termios.h(0p) - Linux manual page</a> - man7.org</p></li>
<li><p><a class="reference external" href="https://linux.die.net/man/3/cfsetspeed">cfsetspeed(3) - Linux man page</a> - linux.die.net</p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../4-modem/4.0-intro.html" class="btn btn-neutral float-right" title="Comunicação Via Modem" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="3.3-register.html" class="btn btn-neutral float-left" title="Registradores" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, Gabriel Araujo

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>